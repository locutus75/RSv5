const b=new Map(); export function checkRate(t){const k=t.name||'default',n=Date.now(),c=t.policy?.rateLimit||{},m=c.perMinute||0,h=c.perHour||0;let x=b.get(k);if(!x){x={minute:{count:0,ts:n},hour:{count:0,ts:n}};b.set(k,x);} if(n-x.minute.ts>=6e4)x.minute={count:0,ts:n}; if(n-x.hour.ts>=36e5)x.hour={count:0,ts:n}; if(m&&x.minute.count>=m) throw new Error('Rate limit (per minute) exceeded'); if(h&&x.hour.count>=h) throw new Error('Rate limit (per hour) exceeded'); x.minute.count++; x.hour.count++; }
