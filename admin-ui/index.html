<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>RileeSurfis Admin</title>
      <link rel="icon" type="image/png" href="favicon.png">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="toast" class="toast hidden"></div>
  <header>
    <div class="left">
      <h1>RileeSurfis <span class="muted">Admin</span> <span class="version clickable" id="versionHeader">...</span>
        <div id="versionMenu" class="version-menu hidden">
          <div class="version-menu-item" id="checkUpdateBtn">
            <span>üîÑ</span> Controleren op updates
          </div>
          <div class="version-menu-item hidden" id="downloadUpdateBtn">
            <span>‚¨áÔ∏è</span> Download update
          </div>
          <div class="version-menu-item hidden" id="installUpdateBtn">
            <span>‚ö°</span> Installeer en activeer
          </div>
          <div class="version-menu-separator"></div>
          <div class="version-menu-item" id="versionInfoBtn">
            <span>‚ÑπÔ∏è</span> Versie informatie
          </div>
        </div>
      </h1>
      <div class="status">
        <span class="dot" id="healthDot" title="Server status"></span>
        <span id="healthText" class="muted">checking‚Ä¶</span>
      </div>
    </div>
    <div class="center">
      <div class="logo">
        <img src="logo.png" alt="RileeSurfis Logo" />
      </div>
    </div>
    <div class="right auth">
      <button id="settingsBtn" class="ghost" title="Service Instellingen">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
      <input id="token" type="password" placeholder="Admin token (Bearer)" />
      <button id="saveToken" class="primary">Opslaan</button>
    </div>
  </header>

  <main class="grid">
    <section class="card" id="statsCard">
      <div class="card-head">
        <h2>Statistieken<span id="statsResetTime" class="muted" style="font-size: 0.7em; font-weight: normal; margin-left: 8px;"></span></h2>
        <div class="actions">
          <select id="tenantFilterStats"><option value="">Alle tenants</option></select>
          <select id="statsWindow">
            <option value="15m">15 min</option>
            <option value="60m">60 min</option>
            <option value="24h" selected>24 uur</option>
            <option value="3d">3 dagen</option>
            <option value="7d">7 dagen</option>
            <option value="14d">14 dagen</option>
            <option value="all">Alles</option>
          </select>

          <button id="refreshStats">Vernieuw</button>
          <button id="exportStatsCsv">Export Stats CSV</button>
          <button id="resetStats" class="ghost" style="color: var(--danger);">Reset</button>
        </div>
      </div>
      <div class="table-wrap">
        <table id="statsTable">
          <thead>
            <tr>
              <th>Tenant</th>
              <th>Verzonden</th>
              <th>Errors</th>
              <th>Trend</th>
              <th>Acties</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <h2>Tenants</h2>
        <div class="actions">
          <button id="reloadBtn">üîÑ Reload Tenants</button>
          <button id="newTenantBtn" class="primary">Nieuwe tenant</button>
        </div>
      </div>
      <div class="table-wrap">
        <table id="tenantsTable">
          <thead>
            <tr>
              <th data-k="name">Naam</th>
              <th data-k="delivery">Mail Delivery</th>
              <th style="text-align: right;">Acties</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    

    <section class="card events-card" id="eventsCard">
      <div class="card-head">
        <h2>Laatste events<span id="logsResetTime" class="muted" style="font-size: 0.7em; font-weight: normal; margin-left: 8px;"></span></h2>
        <div class="actions">
          <select id="tenantFilterEvents"><option value="">Alle tenants</option></select>
          <div class="multiselect-wrapper">
            <button type="button" class="multiselect-trigger" id="eventsLevelFilterTrigger">
              <span id="eventsLevelFilterText">Alle niveaus</span>
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 4.5L6 7.5L9 4.5"/>
              </svg>
            </button>
            <div class="multiselect-dropdown hidden" id="eventsLevelFilterDropdown">
              <div class="multiselect-options">
                <label class="multiselect-option">
                  <input type="checkbox" value="deliver.ok" class="level-checkbox">
                  <span>deliver.ok</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="deliver.err" class="level-checkbox">
                  <span>deliver.err</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="deliver.info" class="level-checkbox">
                  <span>deliver.info</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="deliver.warn" class="level-checkbox">
                  <span>deliver.warn</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="config.info" class="level-checkbox">
                  <span>config.info</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="config.warn" class="level-checkbox">
                  <span>config.warn</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="config.error" class="level-checkbox">
                  <span>config.error</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="mail.error" class="level-checkbox">
                  <span>mail.error</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="debug" class="level-checkbox">
                  <span>debug</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="info" class="level-checkbox">
                  <span>info</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="warn" class="level-checkbox">
                  <span>warn</span>
                </label>
                <label class="multiselect-option">
                  <input type="checkbox" value="error" class="level-checkbox">
                  <span>error</span>
                </label>
              </div>
            </div>
          </div>
          <select id="eventsReasonFilter">
            <option value="all">Alle events</option>
            <option value="success">Alleen geslaagde pogingen</option>
            <option value="errors">Alleen errors</option>
            <option value="config">Configuratie wijzigingen</option>
            <option value="ip_not_allowed">IP niet toegestaan</option>
            <option value="sender_not_allowed">Afzender niet toegestaan</option>
            <option value="tenant_ip_not_allowed">Tenant IP niet toegestaan</option>
            <option value="message_too_large">Bericht te groot</option>
            <option value="tls_required">TLS vereist</option>
            <option value="fallback">Fallback tenant</option>
          </select>
          <select id="eventsLimit">
            <option>100</option>
            <option selected>200</option>
            <option>500</option>
          </select>
          <label class="check"><input type="checkbox" id="eventsAuto" checked/> Auto-refresh</label>
          <button id="refreshEvents">Vernieuw</button>
          <button id="exportEventsCsv">Export CSV</button>
          <button id="resetLogs" class="ghost" style="color: var(--danger);">Reset Logs</button>
          <button id="eventColumnConfigBtn" class="ghost" title="Kolom Zichtbaarheid">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="9" y1="3" x2="9" y2="21"></line>
              <line x1="9" y1="9" x2="21" y2="9"></line>
              <line x1="9" y1="15" x2="21" y2="15"></line>
            </svg>
          </button>
          <button id="eventColorConfigBtn" class="ghost" title="Event Kleur Configuratie">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="table-wrap">
        <div id="eventsLoadingOverlay" class="loading-overlay hidden">
          <div class="loading-spinner"></div>
          <div class="loading-text">Logbestand wordt geladen...</div>
        </div>
        <table id="eventsTable">
          <thead><tr>
            <th data-column="time">Tijd</th>
            <th data-column="level">Niveau</th>
            <th data-column="reason">Reden</th>
            <th data-column="tenant">Tenant</th>
            <th data-column="from">From</th>
            <th data-column="rcpts">Rcpts</th>
            <th data-column="kb">KB</th>
            <th data-column="remoteip">Remote IP</th>
            <th data-column="info">Info</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>


  </main>

  <footer>
    <small>Beveilig de Admin API met <code>ADMIN_TOKEN</code> en plaats desnoods achter een reverse proxy met TLS en IP-allowlist.</small>
  </footer>

  <div id="chartModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-head">
        <h3 id="chartTitle">Trend</h3>
        <div class="actions">
          <select id="chartWindow">
            <option value="15m">15 min</option>
            <option value="60m">60 min</option>
            <option value="24h" selected>24 uur</option>
            <option value="3d">3 dagen</option>
            <option value="7d">7 dagen</option>
            <option value="14d">14 dagen</option>
            <option value="all">Alles</option>
          </select>
          <button id="closeChartTop" class="ghost">Sluiten</button>
        </div>
      </div>
      <div id="chartBody"></div>
      <div class="modal-footer" style="padding: 12px 14px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px;">
        <button id="closeChartBottom" class="ghost">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Tenant Form Modal -->
  <div id="tenantModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-head">
        <h3 id="tenantModalTitle">Tenant</h3>
        <div class="actions">
          <button id="tenantTestTop" class="ghost" style="color: var(--pri);">Testen</button>
          <button id="tenantSaveTop" class="primary">Opslaan</button>
          <button id="tenantClose" class="ghost">Sluiten</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <!-- Tenant Naam Sectie -->
          <div class="field" style="grid-column: 1 / -1; display: flex; align-items: center; gap: 12px;">
            <h4 style="margin: 0; white-space: nowrap;">Tenant Naam</h4>
            <input id="tfName" type="text" placeholder="Naam" style="flex: 1; margin: 0;"/>
          </div>
          
          <!-- Algemene Configuratie (voor beide opties) -->
          <div class="field" style="grid-column: 1 / -1;"><h4>Algemene Configuratie</h4></div>
          <div class="field"><label>Allowed senders <span class="hint">(1 per regel) - gebruikt voor routing en sender validatie</span>
            <textarea id="tfAllowedSenders" rows="3" placeholder="noreply@tenant.tld"></textarea>
          </label></div>
          <div class="field"><label>Routing domains <span class="hint">(1 per regel) - gebruikt voor tenant routing</span>
            <textarea id="tfSenderDomains" rows="3" placeholder="example.com"></textarea>
          </label></div>
          <div class="field"><label>Routing IP ranges <span class="hint">(1 per regel) - gebruikt voor tenant routing</span>
            <textarea id="tfIpRanges" rows="3" placeholder="203.0.113.0/24"></textarea>
            <button type="button" id="addServerIPsBtn" class="ghost" style="margin-top: 6px; white-space: nowrap; padding: 8px 12px;" title="Voeg server IP-adressen toe">+ Server IP's</button>
          </label></div>
          <div class="field" style="width: 30%;"><label>Prioriteit<input id="tfPriority" type="number" min="0" placeholder="100"/></label></div>
          <div class="field"><label>Force From <span class="hint">(optioneel)</span><input id="tfForceFrom" type="email" placeholder="override@tenant.tld"/></label></div>
          <div class="field"><label>Max size (KB)<input id="tfMaxSize" type="number" min="0" placeholder="5120"/></label></div>
          <div class="field"><label>Rate per minuut<input id="tfRatePerMinute" type="number" min="0" placeholder="60"/></label></div>
          <div class="field"><label>Rate per uur<input id="tfRatePerHour" type="number" min="0" placeholder="5000"/></label></div>
          <div class="field"><label>BCC-archive<input id="tfBccArchive" type="email" placeholder="archive@tenant.tld"/></label></div>
  
          <div class="field"><label>Tags <span class="hint">(komma-gescheiden)</span>
            <input id="tfTags" type="text" placeholder="prod, important"/>
          </label></div>
          
          <!-- Mail Delivery Sectie - Twee kolommen -->
          <div class="field" style="grid-column: 1 / -1;"><h4>Mail Delivery</h4></div>
          <div class="field" style="grid-column: 1 / -1;">
            <div class="delivery-methods-grid">
              <!-- Upstream SMTP Server (Links) -->
              <div class="delivery-method-panel">
                <label class="radio-label">
                  <input type="radio" name="deliveryMethod" value="smtp"> 
                  <strong>Upstream SMTP Server</strong>
                </label>
                <div style="margin-top: 12px;">
                  <select id="tfSmtpServer" style="width: 100%;">
                    <option value="">Kies een server...</option>
                  </select>
                  <p class="muted small" style="margin-top: 8px;">Selecteer een SMTP server die is geconfigureerd in de Global Settings.</p>
                </div>
              </div>
              
              <!-- Microsoft Graph API (Rechts) -->
              <div class="delivery-method-panel" id="graphConfigSection">
                <label class="radio-label">
                  <input type="radio" name="deliveryMethod" value="graph" checked> 
                  <strong>Microsoft Graph API</strong> (Standaard)
                </label>
                <p class="muted small" style="margin-left: 24px; margin-top: 4px;">Gebruikt de geconfigureerde Azure AD app credentials om mails te verzenden via de Microsoft Graph API.</p>
                
                <!-- Microsoft Graph API Configuratie velden (alleen zichtbaar bij Graph optie) -->
                <div id="graphConfigFields" style="margin-top: 12px;">
                  <div class="form-grid-inner">
                    <div class="field"><label>Tenant ID<span class="hint"> (GUID) *</span><input id="tfTenantId" type="text" placeholder="00000000-0000-0000-0000-000000000000"/></label></div>
                    <div class="field"><label>Client ID<span class="hint"> (App ID) *</span><input id="tfClientId" type="text" placeholder="11111111-2222-3333-4444-555555555555"/></label></div>
                    <div class="field"><label>Default mailbox *<input id="tfDefaultMailbox" type="email" placeholder="noreply@tenant.tld"/></label></div>
                    <div class="field"><label>Cert path *<input id="tfCertPath" type="text" placeholder="./certs/tenant.pem"/></label></div>
                    <div class="field"><label>Thumbprint *<input id="tfThumbprint" type="text" placeholder="CERTIFICATE THUMBPRINT"/></label></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
  
          <p class="muted" style="grid-column: 1 / -1">Opmerking: <code>senderOverrides</code> wordt standaard leeg gezet en kan later via JSON geavanceerd worden ingevuld.</p>
        </div>
        <div class="button-row"><button id="tenantTestBottom" class="ghost" style="color: var(--pri);">Testen</button><button id="tenantSave" class="primary">Opslaan</button><button id="tenantCloseBottom" class="ghost">Sluiten</button></div>
      </div>
    </div>
  </div>

  <!-- Test Result Modal -->
  <div id="testResultModal" class="modal hidden">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-head">
        <h3 id="testResultTitle">Test Resultaten</h3>
        <div class="actions">
          <button id="testResultClose" class="ghost">Sluiten</button>
        </div>
      </div>
      <div class="modal-body">
        <div id="testResultContent"></div>
        <div id="testEmailSection" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
          <h4 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 600;">Test Email Versturen</h4>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div>
              <label style="display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px;">Van (From)</label>
              <input type="email" id="testEmailFrom" placeholder="test@example.com" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: #0b1a34; color: var(--text); font-size: 13px;"/>
            </div>
            <div>
              <label style="display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px;">Naar (To) *</label>
              <input type="email" id="testEmailTo" placeholder="ontvanger@example.com" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: #0b1a34; color: var(--text); font-size: 13px;"/>
            </div>
            <div>
              <label style="display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px;">Onderwerp</label>
              <input type="text" id="testEmailSubject" placeholder="Test Email" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: #0b1a34; color: var(--text); font-size: 13px;"/>
            </div>
            <div>
              <label style="display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px;">Bericht</label>
              <textarea id="testEmailBody" rows="4" placeholder="Dit is een test email..." style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: #0b1a34; color: var(--text); font-size: 13px; resize: vertical;"></textarea>
            </div>
            <div>
              <label style="display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px;">Bijlage (optioneel)</label>
              <input type="file" id="testEmailAttachment" multiple style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: #0b1a34; color: var(--text); font-size: 13px; cursor: pointer;"/>
              <div id="testEmailAttachmentList" style="margin-top: 6px; font-size: 12px; color: var(--muted);"></div>
            </div>
            <button id="testEmailSendBtn" class="primary" style="align-self: flex-start;">üìß Verstuur Test Email</button>
            <div id="testEmailResult" style="display: none; margin-top: 8px; padding: 10px; border-radius: 6px; font-size: 13px;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="padding: 12px 14px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px;">
        <button id="testResultCloseBottom" class="ghost">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-head">
        <h3>‚öôÔ∏è Service Instellingen</h3>
        <div class="actions">
          <button id="settingsSaveTop" class="primary">Opslaan</button>
          <button id="settingsClose" class="ghost">Sluiten</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="form-grid">
          <div class="field" style="display: flex; align-items: flex-start; gap: 12px; flex-wrap: nowrap; grid-column: 1 / -1;">
            <div style="flex: 0 0 auto; width: 150px;"><label>Host Name<input id="sfHostName" type="text" placeholder="relay.example.com"/></label></div>
            <div style="flex: 0 0 auto; width: 100px;"><label>Listen Port<input id="sfListenPort" type="number" min="1" max="65535" placeholder="2525"/></label></div>
            <div style="display: flex; flex-direction: column; gap: 8px; flex: 1; margin-left: 16px; padding-top: 24px;">
              <label class="check"><input id="sfRequireTLS" type="checkbox"/><span>Require TLS</span></label>
              <label class="check"><input id="sfOptionalBasicAuth" type="checkbox"/><span>Optional Basic Auth</span></label>
              <label class="check"><input id="sfEnableDebug" type="checkbox"/><span>Debug meldingen weergeven</span></label>
            </div>
          </div>
          
          <div class="field" style="grid-column: 1 / -1;"><h4>TLS Configuratie</h4></div>
          <div class="field"><label>Cert File<input id="sfCertFile" type="text" placeholder="./certs/relay_server.crt"/></label></div>
          <div class="field"><label>Key File<input id="sfKeyFile" type="text" placeholder="./certs/relay_server.key"/></label></div>
          <div class="field"><label>TLS Mode<select id="sfTLSMode">
            <option value="starttls">STARTTLS</option>
            <option value="implicit">Implicit TLS (port 465)</option>
          </select></label></div>
          
          <div class="field" style="grid-column: 1 / -1;"><h4>IP Allowlist</h4></div>
          <div class="field" style="grid-column: 1 / -1;"><label>Allowlist IPs <span class="hint">(1 per regel, CIDR notatie, leeg laten om alleen tenant ipRanges te gebruiken)</span>
            <textarea id="sfAllowlistIPs" rows="4" placeholder="192.168.1.0/24&#10;10.0.0.0/8"></textarea>
          </label></div>
          
          <div class="field" style="grid-column: 1 / -1;"><h4>Tenant Routing Prioriteit</h4></div>
          <div class="field" style="grid-column: 1 / -1;">
            <label>Routing Prioriteit <span class="hint">(sleep items om de volgorde te bepalen - bovenste heeft hoogste prioriteit)</span></label>
            <ul id="sfRoutingPriorityList" class="routing-priority-list">
              <li data-value="allowedSenders" class="routing-priority-item">
                <span class="drag-handle">‚ò∞</span>
                <span class="item-label">Allowed Senders</span>
                <span class="item-desc">(exacte email match)</span>
              </li>
              <li data-value="senderDomains" class="routing-priority-item">
                <span class="drag-handle">‚ò∞</span>
                <span class="item-label">Routing Domains</span>
                <span class="item-desc">(domain match)</span>
              </li>
              <li data-value="ipRanges" class="routing-priority-item">
                <span class="drag-handle">‚ò∞</span>
                <span class="item-label">IP Ranges</span>
                <span class="item-desc">(IP adres match)</span>
              </li>
            </ul>
            <p class="muted small" style="margin-top: 8px;">Sleep items omhoog of omlaag om de volgorde te wijzigen. De bovenste optie wordt als eerste gecontroleerd.</p>
          </div>
          
          <div class="field" style="grid-column: 1 / -1;"><h4>SMTP Servers</h4></div>
          <div class="field" style="grid-column: 1 / -1;">
            <div class="smtp-manager">
              <div class="smtp-list-container">
                <label>Geconfigureerde Servers</label>
                <ul id="smtpList" class="smtp-list">
                  <li class="empty">Geen servers geconfigureerd</li>
                </ul>
              </div>
              <div class="smtp-form">
                <label>Nieuwe Server Toevoegen</label>
                <div class="form-grid inner">
                  <div class="field"><input id="newSmtpName" type="text" placeholder="Naam (bv. Office365 Relay)" /></div>
                  <div class="field"><input id="newSmtpAdres" type="text" placeholder="Adres (bv. smtp.office365.com)" /></div>
                  <div class="field"><input id="newSmtpPoort" type="number" placeholder="Poort (bv. 587)" /></div>
                  <div class="field"><label class="check"><input id="newSmtpRequireAuth" type="checkbox" /> Authenticatie vereist</label></div>
                  <div class="field"><select id="newSmtpAuthUser" style="display:none;">
                    <option value="">Selecteer gebruiker...</option>
                  </select></div>
                  <div class="field"><label class="check"><input id="newSmtpRequireTLS" type="checkbox" /> STARTTLS vereist</label></div>
                  <div class="field" style="grid-column: 1/-1; display: flex; gap: 8px;">
                    <button id="addSmtpServerBtn" class="secondary small">Toevoegen</button>
                  </div>
                </div>
              </div>
              
              <div class="field" style="grid-column: 1 / -1; margin-top: 16px;"><h4>Authenticatie Gebruikers</h4></div>
              <div class="field" style="grid-column: 1 / -1;">
                <div class="auth-users-manager">
                  <div class="auth-users-list-container">
                    <label>Geconfigureerde Gebruikers</label>
                    <ul id="authUsersList" class="smtp-list">
                      <li class="empty">Geen gebruikers geconfigureerd</li>
                    </ul>
                  </div>
                  <div class="auth-users-form">
                    <label>Nieuwe Gebruiker Toevoegen</label>
                    <div class="form-grid inner">
                      <div class="field"><input id="newAuthUsername" type="text" placeholder="Gebruikersnaam" /></div>
                      <div class="field"><input id="newAuthPassword" type="password" placeholder="Wachtwoord" /></div>
                      <div class="field" style="grid-column: 1/-1">
                        <button id="addAuthUserBtn" class="secondary small">Toevoegen</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="field" style="grid-column: 1 / -1;">
            <div class="test-smtp-box" style="border: 1px solid var(--border); padding: 10px; border-radius: 8px; margin-top: 5px;">
              <h5 style="margin:0 0 5px 0">Test SMTP Connectie</h5>
              <div style="display: flex; gap: 10px;">
                <select id="testSmtpSelect" style="flex:1"><option value="">Selecteer server uit lijst...</option></select>
                <button id="testSmtpBtn" class="ghost" style="border: 1px solid var(--border)">Test</button>
              </div>
              <div id="testSmtpResult" class="muted" style="margin-top: 5px; font-size: 12px;"></div>
            </div>
          </div>

        </div>
        <div class="button-row"><button id="settingsSave" class="primary">Opslaan</button><button id="settingsCloseBottom" class="ghost">Sluiten</button></div>
      </div>
    </div>
  </div>

  <!-- Event Kleur Configuratie Modal -->
  <div id="eventColorConfigModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-head">
        <h3>‚öôÔ∏è Event Kleur Configuratie</h3>
        <div class="actions">
          <button id="saveEventColorsTop" class="primary">Opslaan</button>
          <button id="closeEventColorConfig" class="ghost">Sluiten</button>
        </div>
      </div>
      <div class="modal-body">
        <p class="muted">Configureer welke events welke kleur krijgen bij auto-refresh feedback.</p>
        
        <div class="color-config-grid">
          <!-- Error Events (Rood) -->
          <div class="color-section error-section">
            <h3>üî¥ Error Events (Rood)</h3>
            <div class="event-rules">
              <div class="rule-group">
                <label>Level bevat:</label>
                <input type="text" id="errorLevels" placeholder="error,mail.error" class="rule-input" />
              </div>
              <div class="rule-group">
                <label>Reason bevat:</label>
                <input type="text" id="errorReasons" placeholder="err,sender_not_allowed,tenant_ip_not_allowed" class="rule-input" />
              </div>
            </div>
          </div>

          <!-- Warning Events (Oranje) -->
          <div class="color-section warning-section">
            <h3>üü† Warning Events (Oranje)</h3>
            <div class="event-rules">
              <div class="rule-group">
                <label>Level bevat:</label>
                <input type="text" id="warningLevels" placeholder="warning" class="rule-input" />
              </div>
              <div class="rule-group">
                <label>Reason bevat:</label>
                <input type="text" id="warningReasons" placeholder="warn,quota_warning,retry_required" class="rule-input" />
              </div>
            </div>
          </div>

          <!-- Info Events (Blauw) -->
          <div class="color-section info-section">
            <h3>üîµ Info Events (Blauw)</h3>
            <div class="event-rules">
              <div class="rule-group">
                <label>Level bevat:</label>
                <input type="text" id="infoLevels" placeholder="info,debug,verbose" class="rule-input" />
              </div>
              <div class="rule-group">
                <label>Reason bevat:</label>
                <input type="text" id="infoReasons" placeholder="info,debug" class="rule-input" />
              </div>
            </div>
          </div>

          <!-- Success Events (Groen) -->
          <div class="color-section success-section">
            <h3>üü¢ Success Events (Groen)</h3>
            <div class="event-rules">
              <div class="rule-group">
                <label>Level bevat:</label>
                <input type="text" id="successLevels" placeholder="success,ok" class="rule-input" />
              </div>
              <div class="rule-group">
                <label>Reason bevat:</label>
                <input type="text" id="successReasons" placeholder="deliver.ok,ok,message_delivered" class="rule-input" />
              </div>
            </div>
          </div>
        </div>

        <div class="config-help">
          <h4>üí° Hoe het werkt:</h4>
          <ul>
            <li><strong>Level bevat:</strong> Event level moet √©√©n van deze waarden bevatten (komma-gescheiden)</li>
            <li><strong>Reason bevat:</strong> Event reason moet √©√©n van deze waarden bevatten (komma-gescheiden)</li>
            <li><strong>Prioriteit:</strong> Error > Warning > Info > Success (eerste match wint)</li>
            <li><strong>Opslaan:</strong> Configuratie wordt opgeslagen in localStorage</li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="saveEventColors" class="primary">Opslaan</button>
        <button id="resetEventColors" class="ghost">Reset naar Standaard</button>
        <button id="closeEventColorConfigBottom" class="ghost">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Event Kolom Zichtbaarheid Modal -->
  <div id="eventColumnConfigModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-head">
        <h3>üìä Event Kolom Zichtbaarheid</h3>
        <div class="actions">
          <button id="saveEventColumnsTop" class="primary">Opslaan</button>
          <button id="closeEventColumnConfig" class="ghost">Sluiten</button>
        </div>
      </div>
      <div class="modal-body">
        <p class="muted">Selecteer welke kolommen je wilt zien in de events tabel.</p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin: 20px 0;">
          <label class="check">
            <input type="checkbox" id="colTime" checked data-column="time"/>
            <span>Tijd</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colLevel" checked data-column="level"/>
            <span>Niveau</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colReason" checked data-column="reason"/>
            <span>Reden</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colTenant" checked data-column="tenant"/>
            <span>Tenant</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colFrom" checked data-column="from"/>
            <span>From</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colRcpts" checked data-column="rcpts"/>
            <span>Rcpts</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colKb" checked data-column="kb"/>
            <span>KB</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colRemoteIP" checked data-column="remoteip"/>
            <span>Remote IP</span>
          </label>
          <label class="check">
            <input type="checkbox" id="colInfo" checked data-column="info"/>
            <span>Info</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button id="saveEventColumns" class="primary">Opslaan</button>
        <button id="resetEventColumns" class="ghost">Reset naar Standaard</button>
        <button id="closeEventColumnConfigBottom" class="ghost">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirmModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-head">
        <h3 id="confirmTitle">Bevestigen</h3>
      </div>
      <div class="modal-body">
        <p id="confirmMessage"></p>
      </div>
      <div class="modal-footer">
        <button id="confirmCancel" class="ghost">Annuleren</button>
        <button id="confirmOk" class="primary">Bevestigen</button>
      </div>
    </div>
  </div>

  <!-- Update Info Modal -->
  <div id="updateInfoModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-head">
        <h3>üîÑ Update Informatie</h3>
        <button class="ghost" id="updateInfoClose">‚úï</button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <div id="updateInfoContent">
          <div style="text-align: center; padding: 20px;">
            <p class="muted">Update informatie wordt geladen...</p>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="padding: 12px 14px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px;">
        <button id="updateInfoRefresh" class="ghost">üîÑ Opnieuw controleren</button>
        <button id="updateInfoCloseBtn" class="primary">Sluiten</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>

<div id="loginOverlay" class="overlay hidden">
  <div class="overlay-card">
    <div class="login-header">
      <div class="logo">
        <img src="logo.png" alt="RileeSurfis Logo" />
      </div>
      <h2>RileeSurfis Admin</h2>
      <p class="version" id="versionLogin">...</p>
    </div>
    <p class="muted">Voer je admin token in om de beheerconsole te openen.</p>
    <input id="overlayToken" type="password" placeholder="Admin token (Bearer)" />
    <div class="actions">
      <button id="overlaySave" class="primary">Inloggen</button>
    </div>
    <small class="muted">Tip: je kunt ook openen met <code>?token=...</code> in de URL.</small>
  </div>
</div>

</body>
</html>

